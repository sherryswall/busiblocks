function changeChapNameToEditMode(lblChapName, txtBxChapName, edit) { if (edit == true) { $('#' + lblChapName.id).css('display', 'none'); $('#' + txtBxChapName).css('display', 'inline-block') } else { $('#' + lblChapName.id).css('display', 'inline-block'); $('#' + txtBxChapName).css('display', 'none') } } function cancelChapNameChange() { $('#' + lblChapName).css("display", "block"); $('#divEditChapName').css("display", "none") } function InitTxtboxChapName() { $('input[type="text"]').each(function () { this.value = $(this).attr('title'); $(this).addClass('defaultTextBoxValue'); $(this).focus(function () { if (this.value == $(this).attr('title')) { this.value = ''; $(this).removeClass('defaultTextBoxValue') } }); $(this).blur(function () { if (this.value == '' || this.value == 'Add chapter') { this.value = $(this).attr('title'); $(this).addClass('defaultTextBoxValue') } }) }) } function saveContents() { var content = UltimateEditors[UltimateEditorId].GetEditorHTML(); if (content.length > 5000) { var a = content.length % 5000; var contentLength = content.length / 5000; contentLength = parseInt(contentLength, 0); var i = 0; if (a == 0) { for (var j = 1; j <= contentLength; j++) { if (j != contentLength) saveContentSplit(content.substring(i + 1, (j * 5000)), false); else saveContentSplit(content.substring(i + 1, (j * 5000)), true); i = j * 5000 } } else { for (var j = 1; j <= contentLength; j++) { if (j != contentLength) { saveContentSplit(content.substring(i + 1, (j * 5000)), false) } else saveContentSplit(content.substring(i + 1, (j * 5000)), true); i = j * 5000 } } } } function saveContent() { var content = UltimateEditors[UltimateEditorId].GetEditorHTML(); var currentDteTime = new Date(); var contents = { type: "POST", url: "ViewArticle2.aspx/wmAutoSaveChapterContent", data: "{'content':'" + content + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { var lblDraft = document.getElementById(lblLastDraft); if (msg.d == true) $('#' + lblDraft.id).html('<i>Last draft saved at: ' + currentDteTime.toLocaleDateString() + ' - ' + currentDteTime.toLocaleTimeString() + '</i>') }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(contents) } function loadDraftsList(chapterVersionId) { var options = { type: "POST", url: "ViewArticle2.aspx/wmBindDraftsList", data: "{'chapterVersionId':'" + chapterVersionId + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { var table = '<table>'; if (msg.d.length > 0) { for (var i = 0; i < msg.d.length; i++) { var row = '<tr>'; row += '<td><a id=' + msg.d[i].Id + ' name="' + msg.d[i].VersionId + '" onclick=InsertDraft(this.id,this.name);><img id=testImg src=../App_Themes/BusiBlocks/Images/yes.png alt="Select" /></a></td>'; row += '<td><i>Saved on - </i>' + msg.d[i].SaveDate + '</td>'; row += '</tr>'; table += row } } else { var row = '<tr><td>There are no drafts available for this chapter</td></tr>'; table += row } table += '</table>'; $('#divDraftsList').html(table) }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(options) } function addChapter() { var chapterName = document.getElementById(tbxChapName); var pnlChaps = document.getElementById(pnlChapsList); var radPageView1 = document.getElementById(radPageView1); if (!chapterName.value) { showMessage('Please enter a valid chapter name', 'error') } else { var name = chapterName.value; var options = { type: "POST", url: "ViewArticle2.aspx/wmAddChapter", data: "{'chapterName':'" + chapterName.value + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { if (msg.d != '') { var newChapterId = msg.d; displayEditorDiv(true); showMessage(name + ' has been added', 'update'); loadChapter(newChapterId) } else { showMessage('Chapter name already in use', 'error') } }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(options) } chapterName.value = '' } function deleteChapter(id, chVersionId) { var confirmDelete = confirm('Are you sure you want to delete this chapter?'); if (confirmDelete) { IsTimerRunning = false; IsTextEnteredUI = false; enableTimer(IsTextEnteredUI); var options = { type: "POST", url: "ViewArticle2.aspx/wmDeleteChapter", data: "{'chapterId':'" + id + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { var pnl = document.getElementById(pnlChapsList); if (chVersionId == msg.d) { loadChapter('') } __doPostBack(pnl.id, ''); var divReorderListItems = document.getElementById(reorderListEditor); var childCount = $('#' + reorderListEditor).children().size(); if (childCount == 1) { displayEditorDiv(false) } showMessage('Chapter has been deleted', 'update') }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(options) } } function saveDraft() { var content = document.getElementById(UltimateEditorId); var id = $('#saveDraftPrompt').attr('title'); var options = { type: "POST", url: "ViewArticle2.aspx/wmSaveDraft", data: "{'ChaptId':'" + id + "','Content':'" + content + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { IsTextEnteredUI == false; loadChapter(id) }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(options) } function loadChapter(id) { var contentArea = document.getElementById(txtEdit); var txtChaptName = document.getElementById(txtBoxChapterName); var lblChapteNam = document.getElementById(lblChapName); var lblChaptNamEditor = document.getElementById(lblChapNameEditor); IsTimerRunning = false; enableTimer(false); if (id != '') { var options = { type: "POST", url: "ViewArticle2.aspx/wmLoadChapter", data: "{'Id':'" + id + "','IsEdtorChanged':'" + IsTextEnteredUI + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { var chapterContent = msg.d["Content"]; if (txtChaptName != null) { txtChaptName.value = msg.d["Name"]; lblChaptNamEditor.innerHTML = msg.d["Name"] } lblChapteNam.innerHTML = msg.d["Name"]; $('#' + litViewContent).html(chapterContent); if (contentArea != null) { var btnSave = document.getElementById(btnSaveContent); btnSave.disabled = false; txtEditor.set_html(chapterContent); txtEditor.set_editable(true) } showMessage(txtChaptName.value + ' has been selected', 'update') }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(options) } else { lblChapteNam.innerHTML = ''; txtChaptName.value = ''; lblChaptNamEditor.innerHTML = ''; txtEditor.set_html(''); txtEditor.set_editable(false); $('#' + litViewContent).html(''); var btnSave = document.getElementById(btnSaveContent); btnSave.disabled = true } IsTextEnteredUI = false } function checkEditorTextChanges() { if (IsTextEnteredUI == true) { return true } else return false } function enableTimer(val) { var options = { type: "POST", url: "ViewArticle2.aspx/wmIsEditorChanged", data: "{'EditorChanged':'" + val + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(options) } function createOverlay() { $('#overlay').fadeIn('fast') } function displayEditorDiv(show) { var editorDivId = document.getElementById(divEditor); var previewDivId = document.getElementById(divPreview); if (show == true) { $('#' + editorDivId.id).show(); $('#' + previewDivId.id).css('display', 'block') } else { $('#' + editorDivId.id).hide(); $('#' + previewDivId.id).hide() } } function uploadImage() { var t = document.getElementById('attachments') } function ConfirmResize() { return confirm('Your image will be resized. Do you wish to proceeed?') } function showSelectionDiv(obj) { createOverlay(); $('#' + obj).fadeIn("slow") } function hideOverlay(div) { $('#overlay').fadeOut('fast'); $('#' + div).fadeOut('fast') } function InsertLink(id, name, type) { if (type == 'doco') { txtEditor.pasteHtml('<a href=ViewArticle2.aspx?cMode=pub&id=' + id + '&name=' + name.toString() + ' target=_blank>' + name + '</a>') } else if (type == 'chap') { var chapName = ''; var hu = window.location.search.substring(1); var gy = hu.split("&"); for (i = 0; i < gy.length; i++) { ft = gy[i].split("="); if (ft[0] == 'name') { chapName = ft[1] } } } hideOverlay('d1') } function InsertDraft(id, name) { var ultimateEditorObj = UltimateEditors[UltimateEditorId]; var options = { type: "POST", url: "ViewArticle2.aspx/wmLoadDraft", data: "{'Id':'" + id + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { var contentArea = document.getElementById(UltimateEditorId); var chapterDraftContent = msg.d["Content"]; if (chapterDraftContent != null) { var did = document.getElementById('hfDraftId'); did.value = msg.d["Id"]; UltimateEditors[UltimateEditorId].SetEditorHTML(chapterDraftContent) } else UltimateEditors[UltimateEditorId].SetEditorHTML('') }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(options); hideOverlay('d2') } function isAdminMode() { var contents = { type: "POST", url: "ViewArticle2.aspx/wmAdminMode", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { isAdmin = msg.d }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(contents) } function switchModeClick() { if (SwitchMode == 'preview') { switchModes('preview'); SwitchMode = 'edit' } else { switchModes('edit'); SwitchMode = 'preview' } } function switchModes(mode) { var contents = { type: "POST", url: "ViewArticle2.aspx/wmSwitchModes", contentType: "application/json; charset=utf-8", dataType: "json", success: function (msg) { var tempContent = null; tempContent = txtEditor.get_html(); if (mode == 'Preview') { $('#' + litViewContent).html(tempContent) } }, error: function (xhr, ajaxOptions, thrownError) { //alert(xhr.status); //alert(thrownError); } }; $.ajax(contents) } function formatHTML(htmlContent) { var htmlTags = htmlContent.split('>'); var newHTML = ''; for (var i = 0; i < htmlTags.length; i++) { if (htmlTags[i].indexOf('img') == -1 || htmlTags[i].indexOf('p') == -1 || htmlTags[i].indexOf('table') == -1 || htmlTags[i].indexOf('table') == -1 || htmlTags[i].indexOf('a') == -1 || htmlTags[i].indexOf('fieldsset') == -1) { if (htmlTags[i].indexOf('style=\"') != -1) { var attribute = htmlTags[i].substring(htmlTags[i].indexOf('style=\"'), (htmlTags[i].indexOf('\"', htmlTags[i].indexOf('\"') + 1) + 1)); var replacedAttribute = htmlTags[i].replace(attribute, ''); replacedAttribute = replacedAttribute.replace('\\', ''); newHTML += replacedAttribute + '>' } else { if (htmlTags[htmlTags.length - 1] != htmlTags[i]) newHTML += htmlTags[i] + '>'; else newHTML += htmlTags[i] } } else { if (htmlTags[htmlTags.length - 1] != htmlTags[i]) newHTML += htmlTags[i] + '>'; else newHTML += htmlTags[i] } } return newHTML } function showMessage(msg, type) { var lblUpdateMessage = document.getElementById(lblLastDraft); if (type == 'error') lblUpdateMessage.style.color = "Red"; else lblUpdateMessage.style.color = "#568bbd"; lblUpdateMessage.innerHTML = '<i>' + msg + '</i>' } function showUploadRow() { $('#rowUploadFile2').css('display', 'block') }